{% extends 'inicio.html' %}
{% load django_bootstrap5 %}
{% block content %}
{% include "nav.html" %}

<div class="card shadow m-3 col-md-6 mx-auto">
    <div class="card-body">
        <div class="row">
            <h3 class="text-center">
                {# Determina o título baseado na existência do objeto (Edição vs. Cadastro) #}
                {% if object %}Editar Cliente{% else %}Cadastro de Cliente{% endif %}
            </h3>

            {# O formulário precisa do método POST e do enctype para lidar com o upload de arquivos (foto) #}
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                {# Campos Pessoais (Nome, Telefone, Email) #}
                {% bootstrap_field form.nome %}
                {% bootstrap_field form.fone %}
                {% bootstrap_field form.email %}

                {# Campo TIPO (Pessoa Física/Jurídica) #}
                <div class="alert alert-info py-2" role="alert">
                    Selecione o tipo de pessoa antes de preencher o CPF/CNPJ abaixo.
                </div>
                {% bootstrap_field form.tipo %}

                {# Campo CPF/CNPJ #}
                {# Sem JavaScript, este campo fica visível o tempo todo, mas o rótulo é genérico. #}
                {# O help_text é essencial para guiar o usuário na ausência de JS. #}
                <div class="form-group mb-3">
                    <label for="{{ form.cpf_cnpj.id_for_label }}" class="form-label">CPF/CNPJ</label>

                    {# Renderiza o campo de input #}
                    {% bootstrap_field form.cpf_cnpj show_label=False %}

                    {# Adiciona uma dica clara, já que o rótulo não muda #}
                    <div class="form-text">
                        Informe o **CPF** se for Pessoa Física, ou o **CNPJ** se for Pessoa Jurídica.
                    </div>
                </div>

                {# Campo de Foto #}
                {% bootstrap_field form.foto %}

                {# Exibição da Foto Atual (apenas na Edição) #}
                {% if object.foto %}
                <div class="col-12 text-center mb-3">
                    <p class="text-muted">Foto Atual:</p>
                    <img src="{{ object.foto.url }}" class="img-thumbnail" width="100" height="100" alt="Foto do cliente">
                </div>
                {% endif %}

                <div class="text-end mt-4">
                    {% bootstrap_button button_type='submit' content='Salvar' %}
                    <a href="{% url 'clientes' %}" class="btn btn-secondary text-white" type="button">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}